<h2><%= @recipe.title %></h2>
at <%= @recipe.created_at.to_formatted_s(:db) %> <%= link_to '@'+@recipe.user.name, @recipe.user %>
<br>
<% if user_signed_in? %>
  <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
    <div class="btn-group mr-2" role="group" aria-label="Author group">
      <% if can? :update, @recipe %>
        <%= link_to image_tag('pencil.png'), edit_recipe_path, class: "btn btn-secondary" %>
        <%= link_to image_tag('delete.png'), recipe_path(@recipe), method: :delete , data: { confirm: '–í—ã —É–≤–µ—Ä–µ–Ω—ã?' }, class: "btn btn-secondary" %>
        <%= link_to image_tag('step.png'), new_recipe_step_path(recipe_id: @recipe.id), class: "btn btn-secondary" %>
      <% end %>
    </div>
    <div class="btn-group mr-2" role="group" aria-label="User group">
      <% if @recipe.published %>
        <% if current_user.favorite_recipes.where('recipe_id=?', @recipe).count == 1 %>
          <%= link_to image_tag('delete.png'), favorite_recipe_path(@recipe.id), 
                                              method: :delete, data: { confirm: '–í—ã —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏–∑ –∑–∞–∫–ª–∞–¥–æ–∫?' }, 
                                              class: "btn btn-secondary" %>
        <% else %>
          <%= link_to image_tag('bookmark.png'), favorite_recipes_path(@recipe.id), method: :post, 
                                                class: "btn btn-secondary"  %>
        <% end %>
        <% if current_user.empty_fields? %>
          <%= render partial: 'menus/form' %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<% if (!@recipe.published) && (can? :manage, @recipe) %>
  <%= button_to "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å", { action: "publish", id: @recipe.id },
                                data: { confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç? 
                                –û–Ω —Ç–æ—á–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –≤—Å–µ –Ω–æ—Ä–º–∞–º?" }, class: "btn btn-success"  %>
<% end %>
<hr>

<% if @recipe.published %>
<div class="row"> 
  <div class="col-sm-9">
    –û—Ü–µ–Ω–∫–∞: <%= @recipe.get_mark %> <small>(–æ—Ü–µ–Ω–∏–ª–æ: <%= @recipe.marks.count %>)</small>
  </div>


  <% if user_signed_in? %>
  <% if @recipe.marks.where('user_id=?', current_user).count != 1 %>
    <div class="col-sm-1 no-margin">
      <%= button_to "üíó", { action: "like", controller: "marks", recipe_id: @recipe.id },
                                  data: { confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –¥–∞—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –æ—Ç–º–µ—Ç–∫—É 
                                  –¥–∞–Ω–Ω–æ–º—É —Ä–µ—Ü–µ–ø—Ç—É?" }, class: "btn btn-outline-success btn-block"  %> 
    </div>
    <div class="col-sm-1 no-margin">
      <%= button_to "üíî", { action: "dislike", controller: "marks", recipe_id: @recipe.id },
                                  data: { confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –¥–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é –æ—Ç–º–µ—Ç–∫—É 
                                  –¥–∞–Ω–Ω–æ–º—É —Ä–µ—Ü–µ–ø—Ç—É?" }, class: "btn btn-outline-success btn-block"  %> 
    </div>
  <% else %>
    <div class="col-sm-2 no-margin">
      <small><i>(–í—ã —É–∂–µ –¥–∞–≤–∞–ª–∏ –æ—Ü–µ–Ω–∫—É) </i></small>
    </div>
  <% end %>
  <% end %>
</div>
<hr>
<% end %>


<div class="row" >
  <div class="col-sm-6">
    <%= image_tag @recipe.photo.url(:large), class: "card-img-top"  if @recipe.photo? %>
    <% if !@recipe.photo? %>
      <img src="https://vosmarket.ru/uploads/posts/2018-03/1521706426_vosmarket_ru-ulitki.jpg" class="card-img-top" alt="...">
    <% end %>
  </div>
  <div class="col-sm-6">
    <ul class="compositions">
      <li>
        <%= render @recipe.compositions %>
      </li>
    </ul>
    <hr>
    <%= link_to "#"+@recipe.category.title, @recipe.category %>
  </div>
</div>

<div class="jumbotron">    
  <%= @recipe.description.html_safe %>
</div>

<% if @recipe.published %>
  <%= render @recipe.steps.order("position")%>
  <% if @recipe.comments.count == 0 %>
    <h3 align="center">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
  <% else %>
    <h3 align="center">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (<%= @recipe.comments.count %>)</h3>
  <% end %>
  <% if user_signed_in? %>
    <%= render partial: 'comments/form' %>
  <% end %>
  
  <div id="comments" class="comments">
      <%= render @recipe.comments.order(created_at: :DESC)%>
  </div>
<% end %>


